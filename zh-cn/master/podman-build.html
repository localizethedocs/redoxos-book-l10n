<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Building Redox - The Redox Operating System</title>


        <!-- Custom HTML head -->
        <style>
        .light .redox-logo {
            content: url("assets/redox_light_512.png");
        }
        .rust .redox-logo {
            content: url("assets/redox_light_512.png");
        }
        .coal .redox-logo {
            content: url("assets/redox_dark_512.png");
        }
        .navy .redox-logo {
            content: url("assets/redox_dark_512.png");
        }
        .ayu .redox-logo {
            content: url("assets/redox_dark_512.png");
        }
        </style>
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="This book carefully describes the design, implementation, direction, and structure of Redox, the operating system.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Redox Operating System</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="building-redox"><a class="header" href="#building-redox">Building Redox</a></h1>
<p>Congrats on making it this far! Now you will build Redox. This process is for <strong>x86-64</strong> machines (Intel/AMD). There are also similar processes for <a href="./i686.html">i586</a> and <a href="./aarch64.html">AArch64/ARM64</a>.</p>
<p>The build process fetches files from the Redox Gitlab server. From time to time, errors may occur which may result in you being asked to provide a username and password during the build process. If this happens, first check for typos in the <code>git</code> URL. If that doesn't solve the problem and you don't have a Redox GitLab login, try again later, and if it continues to happen, you can let us know through the <a href="./chat.html">chat</a>.</p>
<p>To avoid bugs from different build environments (operating systems) we are using <strong>Rootless Podman</strong> for major parts of the build. <strong>Podman</strong> is invoked automatically and transparently within the Makefiles.</p>
<p>The TL;DR version is <a href="#tldr---new-or-existing-working-directory">here</a>. More details are available in the <a href="./advanced-podman-build.html">Advanced Podman Build</a> page.</p>
<p>You can find out more about Podman on the <a href="https://docs.podman.io/en/latest/Introduction.html">Podman documentation</a>.</p>
<p>(Don't forget to read the <a href="./build-system-reference.html">Build System</a> page to know our build system organization and how it works)</p>
<h2 id="podman-build-overview"><a class="header" href="#podman-build-overview">Podman Build Overview</a></h2>
<p><strong>Podman</strong> is a <strong>container manager</strong> that creates <strong>containers</strong> to execute a Linux distribution <strong>image</strong>. In our case, we are creating an <strong>Debian</strong> image, with a <strong>Rust</strong> installation and all the dependencies needed to build the system and programs.</p>
<p>The build process is performed in your normal working directory, e.g., <code>~/tryredox/redox</code>. Compilation of the Redox components is performed in the container, but the final Redox image (<code>build/$ARCH/$CONFIG/harddrive.img</code> or <code>build/$ARCH/$CONFIG/livedisk.iso</code>) is constructed using <a href="https://github.com/libfuse/libfuse">FUSE</a> running directly on your host machine.</p>
<p>Setting <code>PODMAN_BUILD</code> to 1 in <a href="./configuration-settings.html#config">.config</a>, on the <code>make</code> command line (e.g., <code>make PODMAN_BUILD=1 all</code>) or in the environment (e.g., <code>export PODMAN_BUILD=1; make all</code>) will enable Podman.</p>
<p>First, a <strong>base image</strong> called <code>redox_base</code> will be constructed, with all the necessary packages for the build system. A "home" directory will also be created in <code>build/podman</code>. This is the home directory of your container alter ego, <code>poduser</code>. It will contain the <code>rustup</code> install, and the <code>.bashrc</code>. This takes some time, but is only done when necessary. The <em>tag</em> file <a href="./advanced-podman-build.html#buildcontainertag">build/container.tag</a> is also created at this time to prevent unnecessary image builds.</p>
<p>Then, various <code>make</code> commands are executed in <strong>containers</strong> built from the <strong>base image</strong>. The files are constructed in your working directory tree, just as they would for a non-Podman build. In fact, if all necessary packages are installed on your host system, you can switch Podman on and off relatively seamlessly, although there is no benefit of doing so.</p>
<p>The build process is using <strong>Podman</strong>'s <code>keep-id</code> feature, which allows your regular User ID to be mapped to <code>poduser</code> in the container. The first time a container is built, it takes some time to set up this mapping. After the first container is built, new containers can be built almost instantly.</p>
<h2 id="tldr---new-or-existing-working-directory"><a class="header" href="#tldr---new-or-existing-working-directory">TL;DR - <a href="#new-working-directory">New</a> or <a href="#existing-working-directory">Existing</a> Working Directory</a></h2>
<h3 id="new-working-directory"><a class="header" href="#new-working-directory">New Working Directory</a></h3>
<p>If you have already read the <a href="./building-redox.html">Building Redox</a> instructions, but you wish to use <strong>Podman Build</strong>, follow these steps:</p>
<ol>
<li>
<p>Ensure you have the <code>curl</code> program installed. e.g., for Pop!_OS/Ubuntu/Debian:</p>
<pre><code class="language-sh">which curl || sudo apt-get install curl 
</code></pre>
</li>
<li>
<p>Create a new directory and run <code>podman_bootstrap.sh</code> inside of it. This will clone the repository and install <strong>Podman</strong>.</p>
<pre><code class="language-sh">mkdir -p ~/tryredox
</code></pre>
<pre><code class="language-sh">cd ~/tryredox
</code></pre>
<pre><code class="language-sh">curl -sf https://gitlab.redox-os.org/redox-os/redox/raw/master/podman_bootstrap.sh -o podman_bootstrap.sh
</code></pre>
<pre><code class="language-sh">time bash -e podman_bootstrap.sh
</code></pre>
<p>You may be asked which QEMU installation you want. Please select <code>full</code>.</p>
<p>You may be asked which Podman container runtime you want to use, <code>crun</code> or <code>runc</code>. Choose <code>crun</code>, but <code>runc</code> will also work.</p>
</li>
<li>
<p>Update your path to include <code>cargo</code> and the Rust compiler.</p>
<pre><code class="language-sh">source ~/.cargo/env
</code></pre>
</li>
<li>
<p>Navigate to the <code>redox</code> directory.</p>
<pre><code class="language-sh">cd ~/tryredox/redox
</code></pre>
</li>
<li>
<p>Build the system. This will take some time.</p>
<pre><code class="language-sh">time make all
</code></pre>
</li>
</ol>
<ul>
<li>If the command ask your to choose an image repository select the first item, it will give an error and you need to run the <code>time make all</code> command again</li>
</ul>
<h3 id="existing-working-directory"><a class="header" href="#existing-working-directory">Existing Working Directory</a></h3>
<p>If you already have the build system, simply perform the following steps:</p>
<ol>
<li>
<p>Change to your working directory</p>
<pre><code class="language-sh">cd ~/tryredox/redox
</code></pre>
</li>
<li>
<p>Update the build system and wipe all binaries</p>
<pre><code class="language-sh">make clean pull
</code></pre>
</li>
<li>
<p>Install Podman. If your Linux distribution is not supported, check the <a href="./advanced-podman-build.html#installation">installation instructions</a> to determine which dependencies are needed. Or, run the following in your <code>redox</code> base` directory:</p>
<pre><code class="language-sh">./podman_bootstrap.sh -d
</code></pre>
</li>
<li>
<p>Enable Podman.</p>
<pre><code class="language-sh">nano .config
</code></pre>
<pre><code>PODMAN_BUILD?=1
</code></pre>
<blockquote>
<p>üìù <strong>Note:</strong> the initial container setup for the Podman build can take 15 minutes or more, but it is comparable in speed to native build after that.</p>
</blockquote>
</li>
<li>
<p>Build the Redox image.</p>
<pre><code class="language-sh">make all
</code></pre>
</li>
</ol>
<h3 id="run-in-a-virtual-machine"><a class="header" href="#run-in-a-virtual-machine">Run in a virtual machine</a></h3>
<p>You can immediately run the new image (<code>build/x86_64/desktop/harddrive.img</code>) in a virtual machine with the following command:</p>
<pre><code class="language-sh">make qemu
</code></pre>
<blockquote>
<p>üìù <strong>Note:</strong> if you are building the system using <code>build.sh</code> to change the CPU architecture or filesystem contents, you can also provide the <code>qemu</code> option to run the virtual machine:</p>
<pre><code class="language-sh">./build.sh -a i586 -c demo qemu
</code></pre>
<p>This will build <code>build/i586/demo/harddrive.img</code> (if it doesn't already exist) and run it in the QEMU emulator.</p>
</blockquote>
<p>The emulator will display the Redox GUI (Orbital). See <a href="./running-vm.html#using-the-emulation">Using the emulation</a> for general instructions and <a href="./trying-out-redox.html">Trying out Redox</a> for things to try.</p>
<h4 id="run-without-a-gui"><a class="header" href="#run-without-a-gui">Run without a GUI</a></h4>
<p>To run the virtual machine without a GUI, use:</p>
<pre><code class="language-sh">make qemu gpu=no
</code></pre>
<p>If you want to capture the terminal output, read the <a href="./troubleshooting.html#debug-methods">Debug Methods</a> section.</p>
<blockquote>
<p>üí° <strong>Tip:</strong> if you encounter problems running the virtual machine, try turning off various virtualization features with <code>make qemu kvm=no</code> or <code>make qemu iommu=no</code>. These same arguments can also be used with <code>build.sh</code>.</p>
</blockquote>
<h4 id="qemu-tap-for-network-testing"><a class="header" href="#qemu-tap-for-network-testing">QEMU Tap For Network Testing</a></h4>
<p>Expose Redox to other computers within a LAN. Configure QEMU with a "TAP" which will allow other computers to test Redox client/server/networking capabilities.</p>
<p>Please join the <a href="./chat.html">chat</a> if this is something you are interested in pursuing.</p>
<h3 id="building-a-redox-bootable-image"><a class="header" href="#building-a-redox-bootable-image">Building A Redox Bootable Image</a></h3>
<p>Read the <a href="./coding-and-building.html#testing-on-real-hardware">Testing on Real Hardware</a> section.</p>
<h2 id="contributor-note"><a class="header" href="#contributor-note">Contributor Note</a></h2>
<p>If you intend to contribute to Redox or its subprojects, please read the <a href="https://gitlab.redox-os.org/redox-os/redox/-/blob/master/CONTRIBUTING.md">CONTRIBUTING</a> document to understand how the Redox build system works, and how to set up your repository fork appropriately. You can use <code>./bootstrap.sh -d</code> in the <code>redox</code> folder to install the prerequisite packages if you have already done a <code>git clone</code> of the sources.</p>
<p>If you encounter any bugs, errors, obstructions, or other annoying things, please join the <a href="./chat.html">chat</a> or <a href="./creating-proper-bug-reports.html">report the issue</a> to the <a href="https://gitlab.redox-os.org/redox-os/redox">build system repository</a> or a proper repository for the component. Thanks!</p>
<h3 id="buildsh"><a class="header" href="#buildsh">build.sh</a></h3>
<p><code>build.sh</code> is a shell script for quickly invoking <code>make</code> for a specified variant, CPU architecture, and output file.</p>
<blockquote>
<p>üí° <strong>Tip:</strong> for doing Redox development, such settings should usually be configured in the <code>.config</code> file (see the <a href="./configuration-settings.html">Configuration Settings</a> page). But for users who are just trying things out, the <code>build.sh</code> script can be used to run <code>make</code> for you.</p>
</blockquote>
<h4 id="example-1"><a class="header" href="#example-1">Example 1</a></h4>
<p>The following builds the <code>server</code> variant of Redox for the <code>i586</code> (32-bit Intel/AMD) CPU architecture (defined in <code>config/i586/server.toml</code>):</p>
<pre><code>./build.sh -a i586 -c server live
</code></pre>
<p>The resulting image is <code>build/i586/server/livedisk.iso</code>, which can be used to install Redox from a USB device.</p>
<h4 id="example-2"><a class="header" href="#example-2">Example 2</a></h4>
<p>The following builds the <code>desktop</code> variant of Redox for the <code>aarch64</code> (64-bit ARM) CPU architecture (defined in <code>config/aarch64/desktop.toml</code>).</p>
<pre><code>./build.sh -f config/aarch64/desktop.toml qemu
</code></pre>
<p>The resulting image is <code>build/aarch64/desktop/harddrive.img</code>, which is then run in the QEMU emulator upon completion of the build.</p>
<blockquote>
<p>üí° <strong>Tip:</strong> if you are going to use <code>build.sh</code> repeatedly, it's recommended that you do so <em>consistently</em>. The script's underlying <code>make</code> command doesn't keep any record of the build settings used between <code>build.sh</code> runs.</p>
</blockquote>
<p>Details of <code>build.sh</code> and other settings are described in the <a href="./configuration-settings.html">Configuration Settings</a> page.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="build-process.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="building-redox.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="build-process.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="building-redox.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
