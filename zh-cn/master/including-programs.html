<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Including Programs in Redox - The Redox Operating System</title>


        <!-- Custom HTML head -->
        <style>
        .light .redox-logo {
            content: url("assets/redox_light_512.png");
        }
        .rust .redox-logo {
            content: url("assets/redox_light_512.png");
        }
        .coal .redox-logo {
            content: url("assets/redox_dark_512.png");
        }
        .navy .redox-logo {
            content: url("assets/redox_dark_512.png");
        }
        .ayu .redox-logo {
            content: url("assets/redox_dark_512.png");
        }
        </style>
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="This book carefully describes the design, implementation, direction, and structure of Redox, the operating system.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Redox Operating System</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="including-programs-in-redox"><a class="header" href="#including-programs-in-redox">Including Programs in Redox</a></h1>
<p>(Before reading this page you must read the <a href="./build-system-reference.html">Build System</a> page)</p>
<p>This page will teach you how to add programs on the Redox image, it's a simplified version of the <a href="./porting-applications.html">Application Porting</a> page.</p>
<ul>
<li><a href="#existing-recipe">Existing Recipe</a>
<ul>
<li><a href="#setup-the-redox-build-environment">Setup the Redox Build Environment</a></li>
<li><a href="#setup-your-configuration">Setup Your Configuration</a></li>
<li><a href="#build-the-system">Build the System</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#update-crates">Update crates</a></li>
</ul>
</li>
<li><a href="#modifying-an-existing-recipe">Modifying an Existing Recipe</a></li>
<li><a href="#create-your-own-hello-world">Create Your Own Hello World</a>
<ul>
<li><a href="#setting-up-the-recipe">Setting up the recipe</a></li>
<li><a href="#writing-the-program">Writing the program</a></li>
<li><a href="#adding-the-program-to-the-redox-image">Adding the program to the Redox image</a></li>
</ul>
</li>
<li><a href="#running-your-program">Running your program</a></li>
</ul>
<p>The Cookbook system makes the packaging process very simple. First, we will show how to add an existing program for inclusion. Then we will show how to create a new program to be included. In the <a href="./coding-and-building.html">Coding and Building</a> page, we discuss the development cycle in more detail.</p>
<h2 id="existing-recipe"><a class="header" href="#existing-recipe">Existing Recipe</a></h2>
<p>Redox has many programs that are available for inclusion. Each program has a recipe in the directory <code>recipes/recipe-name</code>. Adding an existing program to your build is as simple as adding it to <code>config/$ARCH/my-config.toml</code>, or whatever name you choose for your filesystem configuration. Here we will add the <code>games</code> package, which contains several terminal games.</p>
<h3 id="setup-the-redox-build-environment"><a class="header" href="#setup-the-redox-build-environment">Setup the Redox Build Environment</a></h3>
<ul>
<li>Follow the steps in the <a href="./podman-build.html">Building Redox</a> or <a href="./building-redox.html">Native Build</a> pages to create the Redox Build Environment on your system.</li>
<li>Build the system as described. This will take quite a while the first time.</li>
<li>Run the system in <strong>QEMU</strong>.</li>
</ul>
<pre><code class="language-sh">cd ~/tryredox/redox
</code></pre>
<pre><code class="language-sh">make qemu
</code></pre>
<p>Assuming you built the default configuration <code>desktop</code> for <code>x86_64</code>, none of the Redox games (e.g. <code>/usr/bin/minesweeper</code>) have been included yet.</p>
<ul>
<li>On your Redox emulation, log into the system as user <code>user</code> with an empty password.</li>
<li>Open a <code>Terminal</code> window by clicking on the icon in the toolbar at the bottom of the Redox screen, and type <code>ls /usr/bin</code>. You will see that <code>minesweeper</code> <strong>is not</strong> listed.</li>
<li>Type <code>Ctrl-Alt-G</code> to regain control of your cursor, and click the upper right corner of the Redox window to exit QEMU.</li>
</ul>
<h3 id="setup-your-configuration"><a class="header" href="#setup-your-configuration">Setup your Configuration</a></h3>
<p>Read the <a href="./configuration-settings.html">Configuration Settings</a> page and follow the commands below.</p>
<ul>
<li>From your <code>redox</code> base directory, copy an existing configuration and edit it.</li>
</ul>
<pre><code class="language-sh">cd ~/tryredox/redox
</code></pre>
<pre><code class="language-sh">cp config/x86_64/desktop.toml config/x86_64/my-config.toml
</code></pre>
<pre><code class="language-sh">nano config/x86_64/my-config.toml
</code></pre>
<ul>
<li>Look for the <code>[packages]</code> section and add the package to the configuration. You can add the package anywhere in the <code>[packages]</code> section, but by convention, we add them to the end or to an existing related area of the section.</li>
</ul>
<pre><code class="language-toml">...
[packages]
# Add the item below under the "[packages]" section
redox-games = {}
...
</code></pre>
<ul>
<li>Add the <code>CONFIG_NAME</code> environment variable on your <a href="./configuration-settings.html#config">.config</a> to use the <code>myfiles.toml</code> configuration.</li>
</ul>
<pre><code class="language-sh">nano .config
</code></pre>
<pre><code># Add the item below
CONFIG_NAME?=my-config
</code></pre>
<ul>
<li>Save your changes with Ctrl+X and confirm with <code>y</code></li>
</ul>
<h3 id="update-the-system-image"><a class="header" href="#update-the-system-image">Update The System Image</a></h3>
<ul>
<li>In your base <code>redox</code> folder, e.g. <code>~/tryredox/redox</code>, build the system and run it in <strong>QEMU</strong>.</li>
</ul>
<pre><code class="language-sh">cd ~/tryredox/redox
</code></pre>
<pre><code class="language-sh">make rp.redox-games qemu
</code></pre>
<ul>
<li>On your Redox emulation, log into the system as user <code>user</code> with an empty password.</li>
<li>Open a <code>Terminal</code> window by clicking it on the icon in the toolbar at the bottom of the Redox screen, and type <code>ls /usr/bin</code>. You will see that <code>minesweeper</code> <strong>is</strong> listed.</li>
<li>In the terminal window, type <code>minesweeper</code>. Play the game using the arrow keys or <code>WSAD</code>,<code>space</code> to reveal a spot, <code>f</code> to flag a spot when you suspect a mine is present. When you type <code>f</code>, an <code>F</code> character will appear.</li>
</ul>
<p>If you had a problem, use this command to log any possible errors on your terminal output:</p>
<pre><code class="language-sh">make r.recipe-name 2&gt;&amp;1 | tee recipe-name.log
</code></pre>
<p>And that's it! Sort of.</p>
<h3 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h3>
<p>Read the <a href="./porting-applications.html#dependencies">Dependencies</a> section to learn how to handle recipe dependencies.</p>
<h3 id="update-crates"><a class="header" href="#update-crates">Update crates</a></h3>
<p>Read the <a href="./porting-applications.html#update-crates">Update crates</a> section to learn how to update crates on Rust programs.</p>
<h2 id="modifying-an-existing-recipe"><a class="header" href="#modifying-an-existing-recipe">Modifying an Existing Recipe</a></h2>
<p>If you want to make changes to an existing recipe for your own purposes, you can do your work in the directory <code>recipes/recipe-name/source</code>. The Cookbook process will not download sources if they are already present in that folder. However, if you intend to do significant work or to contribute changes to Redox, please read the <a href="./coding-and-building.html">Coding and Building</a> page.</p>
<h2 id="create-your-own-hello-world"><a class="header" href="#create-your-own-hello-world">Create Your Own Hello World</a></h2>
<p>To create your own program to be included, you will need to create the recipe. This example walks through adding the "Hello World" program that the <code>cargo new</code> command automatically generates to the folder of a Rust project.</p>
<p>This process is largely the same for other Rust programs.</p>
<h3 id="setting-up-the-recipe"><a class="header" href="#setting-up-the-recipe">Setting Up The Recipe</a></h3>
<p>The Cookbook will only build programs that have a recipe defined in <code>recipes</code>. To create a recipe for the Hello World program, first create the directory <code>recipes/hello-world</code>. Inside this directory create the "recipe.toml" file and add these lines to it:</p>
<pre><code class="language-toml">[build]
template = "cargo"
</code></pre>
<p>The <code>[build]</code> section defines how Cookbook should build our project. There are several templates but <code>"cargo"</code> should be used for Rust projects.</p>
<p>The <code>[source]</code> section of the recipe tells Cookbook how to download the Git repository/tarball of the program.</p>
<p>This is done if <code>recipes/recipe-name/source</code> does not exist, during <code>make fetch</code> or during the fetch step of <code>make all</code>. For this example, we will simply develop in the <code>source</code> directory, so no <code>[source]</code> section is necessary.</p>
<h3 id="writing-the-program"><a class="header" href="#writing-the-program">Writing the program</a></h3>
<p>Since this is a Hello World example, we are going to have Cargo write the code for us. In <code>recipes/hello-world</code>, do the following:</p>
<pre><code class="language-sh">mkdir source
</code></pre>
<pre><code class="language-sh">cd source
</code></pre>
<pre><code class="language-sh">cargo init --name="hello-world"
</code></pre>
<p>This creates a <code>Cargo.toml</code> file and a <code>src</code> directory with the Hello World program.</p>
<h3 id="adding-the-program-to-the-redox-image"><a class="header" href="#adding-the-program-to-the-redox-image">Adding the program to the Redox image</a></h3>
<p>To be able to run a program inside of Redox, it must be added to the filesystem. As <a href="#existing-package">above</a>, create a filesystem config <code>config/x86_64/myfiles.toml</code> or similar by copying an existing configuration, and modify <code>CONFIG_NAME</code> in <a href="./configuration-settings.html#config">.config</a> to be <code>myfiles</code>. Open <code>config/x86_64/myfiles.toml</code> and add <code>hello-world = {}</code> below the <code>[packages]</code> section.</p>
<p>During the creation of the Redox image, the build system installs those packages on the image filesystem.</p>
<pre><code class="language-toml">[packages]
# Add the item below
hello-world = {}
</code></pre>
<p>To update the Redox image, including your program, run the following commands:</p>
<pre><code class="language-sh">cd ~/tryredox/redox
</code></pre>
<pre><code class="language-sh">make rp.hello-world
</code></pre>
<h2 id="running-your-program"><a class="header" href="#running-your-program">Running your program</a></h2>
<p>Once the rebuild is finished, run <code>make qemu</code>, and when the GUI starts, log in to Redox, open the terminal, and run <code>helloworld</code>. It should print</p>
<pre><code>Hello, world!
</code></pre>
<p>Note that the <code>hello-world</code> binary can be found in <code>/usr/bin</code> on Redox.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="coding-and-building.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="porting-applications.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="coding-and-building.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="porting-applications.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
